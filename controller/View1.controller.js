var string="";var task="";var approval_lvl="";sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/BindingMode","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/ui/core/ValueState","sap/m/MessageToast","sap/ui/core/library"],function(e,t,l,o,i,d,r,s){"use strict";return e.extend("ZGBC_FLEET_RETURN_APPROVE.ZGBC_FLEET_RETURN_APPROVE.controller.View1",{onInit:function(){var e,t;t=this.getView();e=sap.ui.getCore().getMessageManager();t.setModel(e.getMessageModel(),"message");var l={ApprovalLvl:"",DeductionAmount:"",Comments:"",FsviInspectionCleared:"",FsviDeductionApplicable:"",InspectionCleared:"",DeductionApplicable:"",UnitReturned:"",TammUpdated:"",CcUpdated:""};this.oLocalModel=new sap.ui.model.json.JSONModel(l);t.setModel(this.oLocalModel,"localModel");var o={ApproveRequestVisible:false,ApprovalChecksVisible:false,DeductionApplicable:false,DeductionAmountVisible:false,InspectionPerformed:false,UnitReturned:false,TammUpdatedVisbile:false,CCUpdatedVisible:false};this.oLocalModel3=new sap.ui.model.json.JSONModel(o);t.setModel(this.oLocalModel3,"localModel3");var i=window.location.href;var d=i.split("?");var r=d.length;r=r-1;var s=d[r].split("&");var a=s[0].split("=");string=a[1];var c=string;a=s[1].split("=");string=a[1];var p=string;a=s[2].split("=");string=a[1];var g=string;var n="/WorkitemSet('"+p+"')";var u=t.getModel();var M=this;u.read(n,{success:function(e,t){M.getView().getModel("localModel").setProperty("/ApprovalLvl",e.ApprovalLvl);M.getView().getModel("localModel").setProperty("/DeductionAmount",e.DeductionAmount);M.getView().getModel("localModel").setProperty("/FsviInspectionCleared",e.FsviInspectionCleared);M.getView().getModel("localModel").setProperty("/FsviDeductionApplicable",e.FsviDeductionApplicable);M.getView().getModel("localModel").setProperty("/InspectionCleared",e.InspectionCleared);M.getView().getModel("localModel").setProperty("/DeductionApplicable",e.DeductionApplicable);M.getView().getModel("localModel").setProperty("/UnitReturned",e.UnitReturned);M.getView().getModel("localModel").setProperty("/TammUpdated",e.TammUpdated);M.getView().getModel("localModel").setProperty("/CcUpdated",e.CcUpdated);approval_lvl=M.getView().getModel("localModel").getProperty("/ApprovalLvl")},error:function(){}});task=g;n="/FleetReturnHeaderSet('"+c+"')";u=t.getModel();M=this;u.read(n,{urlParameters:{$expand:"ReturnHeaderToItemNav"},success:function(e,t){var l=new sap.ui.model.json.JSONModel(e);var o=M.getView().byId("IdEmpDetail");o.setModel(l);var i=M.getView().byId("IdVehicleSelection");i.setModel(l);if(approval_lvl==="FSV"||approval_lvl==="FS1"||approval_lvl==="FM1"||approval_lvl==="HDR"||approval_lvl==="FS2"||approval_lvl==="FM2"||approval_lvl==="FIN"){M.getView().getModel("localModel3").setProperty("/ApprovalChecksVisible",true);if(approval_lvl==="FSV"){M.getView().getModel("localModel3").setProperty("/ApproveRequestVisible",true);M.getView().getModel("localModel3").setProperty("/InspectionPerformed",true);var d=this.getView().getModel("localModel").getProperty("/FsviInspectionCleared");if(d==="X"){M.getView().byId("idfleetcheck12").setSelected(true)}else{M.getView().byId("idfleetcheck12").setSelected(false)}}if(approval_lvl==="FS1"){M.getView().getModel("localModel3").setProperty("/ApproveRequestVisible",true);M.getView().getModel("localModel3").setProperty("/DeductionApplicable",true);M.getView().getModel("localModel3").setProperty("/InspectionPerformed",true);d=M.getView().getModel("localModel").getProperty("/InspectionCleared");var r=M.getView().getModel("localModel").getProperty("/DeductionApplicable");if(d==="X"){M.getView().byId("idfleetcheck12").setSelected(true)}else{M.getView().byId("idfleetcheck12").setSelected(false)}if(r==="X"){M.getView().byId("idfleetcheck1").setSelected(true);M.getView().getModel("localModel3").setProperty("/DeductionAmountVisible",true)}else{M.getView().byId("idfleetcheck1").setSelected(false)}}if(approval_lvl==="FM1"){M.getView().getModel("localModel3").setProperty("/ApproveRequestVisible",true);M.getView().getModel("localModel3").setProperty("/DeductionApplicable",true);M.getView().getModel("localModel3").setProperty("/InspectionPerformed",true);M.getView().getModel("localModel3").setProperty("/DeductionAmountVisible",true);d=M.getView().getModel("localModel").getProperty("/InspectionCleared");r=M.getView().getModel("localModel").getProperty("/DeductionApplicable");if(r==="X"){M.getView().byId("idfleetcheck1").setSelected(true)}else{M.getView().byId("idfleetcheck1").setSelected(false)}if(d==="X"){M.getView().byId("idfleetcheck12").setSelected(true)}else{M.getView().byId("idfleetcheck12").setSelected(false)}M.getView().byId("idfleetcheck1").setEnabled(false);M.getView().byId("idfleetcheck12").setEnabled(false);M.getView().byId("idDeductionAmount").setEnabled(true)}if(approval_lvl==="HDR"){M.getView().getModel("localModel3").setProperty("/ApproveRequestVisible",false);M.getView().getModel("localModel3").setProperty("/DeductionApplicable",true);M.getView().getModel("localModel3").setProperty("/InspectionPerformed",true);M.getView().getModel("localModel3").setProperty("/DeductionAmountVisible",true);d=M.getView().getModel("localModel").getProperty("/InspectionCleared");r=M.getView().getModel("localModel").getProperty("/DeductionApplicable");if(r==="X"){M.getView().byId("idfleetcheck1").setSelected(true)}else{M.getView().byId("idfleetcheck1").setSelected(false)}if(d==="X"){M.getView().byId("idfleetcheck12").setSelected(true)}else{M.getView().byId("idfleetcheck12").setSelected(false)}M.getView().byId("idfleetcheck1").setEnabled(false);M.getView().byId("idfleetcheck12").setEnabled(false);M.getView().byId("idDeductionAmount").setEditable(false)}if(approval_lvl==="FS2"){M.getView().getModel("localModel3").setProperty("/ApproveRequestVisible",true);var s=M.getView().getModel("localModel").getProperty("/UnitReturned");var a=M.getView().getModel("localModel").getProperty("/TammUpdated");M.getView().getModel("localModel3").setProperty("/UnitReturned",true);M.getView().getModel("localModel3").setProperty("/TammUpdatedVisbile",true);if(s==="X"){M.getView().byId("idfleetcheck13").setSelected(true)}else{M.getView().byId("idfleetcheck13").setSelected(false)}if(a==="X"){M.getView().byId("idfleetcheck14").setSelected(true)}else{M.getView().byId("idfleetcheck14").setSelected(false)}}if(approval_lvl==="FM2"){M.getView().getModel("localModel3").setProperty("/ApproveRequestVisible",false);s=M.getView().getModel("localModel").getProperty("/UnitReturned");a=M.getView().getModel("localModel").getProperty("/TammUpdated");M.getView().getModel("localModel3").setProperty("/UnitReturned",true);M.getView().getModel("localModel3").setProperty("/TammUpdatedVisbile",true);if(s==="X"){M.getView().byId("idfleetcheck13").setSelected(true)}else{M.getView().byId("idfleetcheck13").setSelected(false)}if(a==="X"){M.getView().byId("idfleetcheck14").setSelected(true)}else{M.getView().byId("idfleetcheck14").setSelected(false)}M.getView().byId("idfleetcheck13").setEnabled(false);M.getView().byId("idfleetcheck14").setEnabled(false)}if(approval_lvl==="FIN"){M.getView().getModel("localModel3").setProperty("/ApproveRequestVisible",true);M.getView().getModel("localModel3").setProperty("/CCUpdatedVisible",true);var c=M.getView().getModel("localModel").getProperty("/CcUpdated");if(c==="X"){M.getView().byId("idfincheck11").setSelected(true)}else{M.getView().byId("idfincheck11").setSelected(false)}}}else{M.getView().getModel("localModel3").setProperty("/ApprovalChecksVisible",false)}},error:function(){M.getView().getModel("localModel").setProperty("/ApproveRequestVisible",false);sap.m.MessageToast.show("No Data retreived")}})},onApprove:function(){var e=this.getView().getModel("localModel").getProperty("/Comments");var t=this.getView().byId("idRequestId").getText();var l=" ";var o=" ";var i=" ";var d=" ";var r=" ";var s="0.000";if(approval_lvl==="FSV"){o=this.getView().byId("idfleetcheck12").getSelected();if(o===true){o="X"}else{o=" "}}if(approval_lvl==="FS1"){l=this.getView().byId("idfleetcheck1").getSelected();if(l===true){l="X"}else{l=" "}s=this.getView().byId("idDeductionAmount").getValue();o=this.getView().byId("idfleetcheck12").getSelected();if(o===true){o="X"}else{o=" "}}if(approval_lvl==="FM1"){l=this.getView().byId("idfleetcheck1").getSelected();if(l===true){l="X"}else{l=" "}s=this.getView().byId("idDeductionAmount").getValue()}if(approval_lvl==="FS2"){i=this.getView().byId("idfleetcheck13").getSelected();if(i===true){i="X"}else{i=" "}d=this.getView().byId("idfleetcheck14").getSelected();if(d===true){d="X"}else{d=" "}}if(approval_lvl==="FIN"){r=this.getView().byId("idfincheck11").getSelected();if(r===true){r="X"}else{r=" "}}var a={RequestId:t,ApprovalLvl:approval_lvl,Comments:e,TaskId:task,DeductionApplicable:l,DeductionAmount:s,InspectionCleared:o,UnitReturned:i,TammUpdated:d,CcUpdated:r};var c=this.getView().getModel();var p=this;c.create("/ApproveSet",a,{success:function(e,t){sap.m.MessageToast.show("Service Vehicle Request Has Been Saved Successfully");p.getView().getModel("localModel3").setProperty("/ApproveRequestVisible",false)},error:function(e){var t=jQuery.parseJSON(e.responseText).error.message.value;sap.m.MessageToast.show(t);return}})},showDeductionAmount:function(){var e=this.getView().byId("idfleetcheck1").getSelected();if(e===true){this.getView().getModel("localModel3").setProperty("/DeductionAmountVisible",true)}else{this.getView().getModel("localModel3").setProperty("/DeductionAmountVisible",false)}}})});